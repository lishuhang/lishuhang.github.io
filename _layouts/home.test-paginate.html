---
layout: base
---

<!-- 主内容区域 -->
<div class="flex justify-center py-8">
  <article class="text-center prose prose-p:font-extralight prose-slate dark:prose-invert primary-underline">
    {{ content }}
  </article>
</div>

<!-- 项目容器 -->
<div class="md:w-4/5 mx-auto gap-4 columns-2 md:columns-3 mb-10" id="gallery-container">
  {% for post in paginator.posts %}
  <div class="post-item md:fadeIn pb-4 mb-4 break-inside-avoid-column relative group">
    <div class="gallery-item">
      <a href="{{ post.url | relative_url }}" 
         class="square-container block relative overflow-hidden" 
         target="_blank" 
         rel="noopener noreferrer">
        <img src="{{ post.image | relative_url }}" 
             alt="{{ post.title }}" 
             class="square-image w-full h-full object-cover shadow-md">
        <!-- 悬浮层 -->
        <div class="overlay absolute inset-0 bg-black/70 opacity-0 transition-opacity duration-300 group-hover:opacity-100 group-[.active]:opacity-100">
          <div class="text text-white p-4 flex flex-col h-full justify-center items-center">
            <h2 class="text-lg md:text-xl lg:text-2xl text-center mb-2">{{ post.title }}</h2>
            <div class="tags">
              {% for tag in post.tags limit:3 %}
              <span class="text-xs text-white/80">#{{ tag }}</span>
              {% endfor %}
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
  {% endfor %}
</div>

<!-- 分页控制 -->
<div class="text-center mt-6 mb-10">
  {% if paginator.total_pages > 1 %}
  <a href="#" 
     id="loadMoreBtn" 
     class="px-6 py-3 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors"
     data-next-page="{% if paginator.next_page %}{{ paginator.next_page_path | replace: '.html','' }}{% else %}false{% endif %}">
    {% if paginator.next_page %}Load More{% else %}All Posts Loaded{% endif %}
  </a>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const loadMoreBtn = document.getElementById('loadMoreBtn');
  if (!loadMoreBtn || loadMoreBtn.dataset.nextPage === 'false') return;

  loadMoreBtn.addEventListener('click', async function(e) {
    e.preventDefault();
    const btn = this;
    const originalHTML = btn.innerHTML;
    
    // 加载状态
    btn.classList.add('opacity-50', 'cursor-not-allowed');
    btn.innerHTML = `
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Loading...
    `;

    try {
      const response = await fetch(btn.dataset.nextPage);
      const html = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      // 追加新项目
      const newItems = doc.querySelector('#gallery-container').innerHTML;
      document.getElementById('gallery-container').insertAdjacentHTML('beforeend', newItems);
      
      // 更新按钮状态
      const newBtn = doc.getElementById('loadMoreBtn');
      if (newBtn && newBtn.dataset.nextPage !== 'false') {
        btn.dataset.nextPage = newBtn.dataset.nextPage;
      } else {
        btn.remove();
      }
    } catch (error) {
      console.error('加载失败:', error);
      btn.innerHTML = 'Error! Click to retry';
      btn.classList.remove('opacity-50', 'cursor-not-allowed');
    } finally {
      if (btn.dataset.nextPage === 'false') {
        btn.innerHTML = 'All Posts Loaded';
        btn.classList.remove('hover:bg-slate-700');
      } else {
        btn.innerHTML = originalHTML;
        btn.classList.remove('opacity-50', 'cursor-not-allowed');
      }
    }
  });
});

// 保留原有移动端点击处理
document.querySelectorAll('.gallery-item').forEach(item => {
  // ...原有移动端处理代码...
});
</script>