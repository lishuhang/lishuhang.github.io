---
layout: base
---

<!-- 使用与home相同的两栏布局 -->
<div class="blog-container">
  <!-- 侧边栏 -->
  <aside id="blogSidebar" class="blog-sidebar">
    <div class="blog-sidebar-header">
      <a href="/" class="sidebar-logo-link">
        <img src="{{ '/assets/logo.png' | relative_url }}" alt="Logo" class="sidebar-logo-image">
      </a>
      <a href="/" class="blog-sidebar-title">{{ site.title }}</a>
    </div>
    
    <div class="blog-sidebar-body">
      <!-- 搜索框 -->
      <div class="search-box">
        <input type="text" id="searchInput" class="search-input" placeholder="搜索文章...">
      </div>
      
      <!-- 标签区域 -->
      <div class="tags-section">
        <label class="section-label">标签</label>
        <div class="tags-container">
          {% assign all_tags = site.posts | map: 'tags' | join: ',' | split: ',' | uniq | sort %}
          {% for tag in all_tags %}
            {% if tag != "" %}
            <button class="tag-btn" data-tag="{{ tag }}">{{ tag }}</button>
            {% endif %}
          {% endfor %}
        </div>
      </div>
      
      <!-- 按年份浏览 -->
      <div class="years-section">
        <label class="section-label">按年份浏览</label>
        <div class="years-list">
          {% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" | sort: "name" | reverse %}
          {% for year_group in posts_by_year %}
          <a href="/?year={{ year_group.name }}" class="year-link">
            {{ year_group.name }}年 ({{ year_group.items | size }}篇)
          </a>
          {% endfor %}
        </div>
      </div>
      
      <!-- 更多链接 -->
      <div class="nav-links">
        <label class="section-label">更多</label>
        <a href="/about" class="nav-link">关于</a>
        <a href="/photos" class="nav-link" target="_blank">图片库</a>
      </div>
      
      <!-- 深色模式切换 -->
      <div class="dark-mode-toggle">
        <label class="toggle-label">
          <span>深色模式</span>
          <input type="checkbox" id="darkModeToggle" class="toggle-input">
          <span class="toggle-slider"></span>
        </label>
      </div>
      
      <!-- 版权信息 -->
      <div class="copyright">
        © {{ site.time | date: '%Y' }} 航通社
      </div>
    </div>
  </aside>
  
  <!-- 主内容区 -->
  <main id="blogMain" class="blog-main">
    <!-- 文章详情视图 -->
    <div id="postView" style="display: block;">
      <div id="postContent">
        <!-- 返回列表按钮 -->
        <div style="margin-bottom: 2rem;">
          <a href="/" class="back-to-home" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background-color: var(--bg-hover); border-radius: var(--radius-md); text-decoration: none; transition: all 0.2s;">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0L0 8l8 8V0z"/>
            </svg>
            返回列表
          </a>
        </div>
        
        <!-- 文章头部 -->
        <div class="post-detail-header">
          <h1 class="post-detail-title">{{ page.title }}</h1>
          
          <div class="post-detail-meta">
            <span>{{ page.author | default: site.author }}</span>
            <span>•</span>
            <span>{{ page.date | date: "%Y年%m月%d日" }}</span>
          </div>
          
          {% if page.tags %}
          <div class="post-detail-tags">
            {% for tag in page.tags %}
            <a href="/?tag={{ tag }}" class="post-detail-tag">#{{ tag }}</a>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <!-- 题图 -->
        {% if page.image %}
        <div class="post-detail-image">
          <img src="{{ page.image | relative_url }}" alt="{{ page.title }}">
        </div>
        {% endif %}
        
        <!-- 文章内容 -->
        <div class="post-detail-body">
          <article class="prose">
            {{ content }}
          </article>
        </div>
        
        <!-- 分享按钮 -->
        <div class="share-section">
          <h3 class="share-title">分享到</h3>
          <div class="share-buttons">
            <button class="share-button" onclick="shareToWeibo('{{ page.title }}', '{{ page.url | absolute_url }}')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.75 7.5c-.75 0-1.5.375-2.25.75 0-3-2.25-5.25-5.25-5.25-2.25 0-4.125 1.5-4.875 3.375C4.125 6.75 2.25 8.625 2.25 11.25c0 3.375 3.375 6 7.5 6 5.25 0 9-3.375 9-6.75 0-1.875-1.125-3-3-3z"/></svg>
              微博
            </button>
            <button class="share-button" onclick="shareToTwitter('{{ page.title }}', '{{ page.url | absolute_url }}')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg>
              Twitter
            </button>
            <button class="share-button" onclick="shareToFacebook('{{ page.url | absolute_url }}')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
              Facebook
            </button>
            <button class="share-button" onclick="alert('请使用微信扫一扫分享本页面')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
              微信
            </button>
            <button class="share-button" onclick="copyLink('{{ page.url | absolute_url }}')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
              复制链接
            </button>
          </div>
        </div>
        
        <!-- 上一篇/下一篇导航 -->
        <div class="post-navigation">
          {% if page.previous %}
          <a href="{{ page.previous.url | relative_url }}" class="post-nav-button post-nav-prev">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15 18l-6-6 6-6"/>
            </svg>
            <div class="post-nav-content">
              <span class="post-nav-label">上一篇</span>
              <span class="post-nav-title">{{ page.previous.title }}</span>
            </div>
          </a>
          {% endif %}
          
          {% if page.next %}
          <a href="{{ page.next.url | relative_url }}" class="post-nav-button post-nav-next">
            <div class="post-nav-content">
              <span class="post-nav-label">下一篇</span>
              <span class="post-nav-title">{{ page.next.title }}</span>
            </div>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </a>
          {% endif %}
        </div>
        
        <!-- 评论系统 -->
        <div class="comments-section">
          <script src="https://giscus.app/client.js"
                  data-repo="lishuhang/lishuhang.github.io"
                  data-repo-id="R_kgDOKbcVHw"
                  data-category="Announcements"
                  data-category-id="DIC_kwDOKbcVH84CwoJY"
                  data-mapping="specific"
                  data-term="{{ page.url | absolute_url }}"
                  data-strict="0"
                  data-reactions-enabled="1"
                  data-emit-metadata="0"
                  data-input-position="top"
                  data-theme="preferred_color_scheme"
                  data-lang="zh-CN"
                  crossorigin="anonymous"
                  async>
          </script>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- 移动端遮罩层 -->
<div class="sidebar-overlay" onclick="closeMobileSidebar()"></div>

<script>
// 分享功能
function shareToWeibo(title, url) {
  window.open(`https://service.weibo.com/share/share.php?title=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`, '_blank');
}

function shareToTwitter(title, url) {
  window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`, '_blank');
}

function shareToFacebook(url) {
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
}

function copyLink(url) {
  navigator.clipboard.writeText(url).then(() => {
    alert('链接已复制到剪贴板');
  });
}

// 侧边栏功能
function closeMobileSidebar() {
  const sidebar = document.getElementById('blogSidebar');
  const overlay = document.querySelector('.sidebar-overlay');
  if (sidebar) sidebar.classList.remove('mobile-open');
  if (overlay) overlay.classList.remove('active');
  document.body.style.overflow = '';
}

// 深色模式
function initDarkMode() {
  const darkModeToggle = document.getElementById('darkModeToggle');
  if (!darkModeToggle) return;
  
  const savedTheme = localStorage.getItem('theme');
  
  if (savedTheme) {
    applyTheme(savedTheme);
    darkModeToggle.checked = savedTheme === 'dark';
  } else {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = prefersDark ? 'dark' : 'light';
    applyTheme(theme);
    darkModeToggle.checked = prefersDark;
  }
  
  darkModeToggle.addEventListener('change', (e) => {
    const theme = e.target.checked ? 'dark' : 'light';
    applyTheme(theme);
    localStorage.setItem('theme', theme);
  });
  
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      const theme = e.matches ? 'dark' : 'light';
      applyTheme(theme);
      darkModeToggle.checked = e.matches;
    }
  });
}

function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  document.body.setAttribute('data-theme', theme);
  
  const giscusFrame = document.querySelector('iframe.giscus-frame');
  if (giscusFrame) {
    const giscusTheme = theme === 'dark' ? 'dark' : 'light';
    giscusFrame.contentWindow.postMessage(
      { giscus: { setConfig: { theme: giscusTheme } } },
      'https://giscus.app'
    );
  }
}

// 初始化
document.addEventListener('DOMContentLoaded', initDarkMode);
</script>

